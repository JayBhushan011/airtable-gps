<!DOCTYPE html>
<html>
<head>
    <title>Get GPS Coordinates</title>
</head>
<body>
    <button onclick="getLocation()">Get GPS Coordinates</button>
    <script>
        function getLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            // Request GPS access
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Extract the Airtable record ID from the URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const recordId = urlParams.get('recordId');

                    // Update Airtable
                    try {
                        const response = await fetch(
                            `https://api.airtable.com/v0/YOUR_BASE_ID/YOUR_TABLE_NAME/${recordId}`,
                            {
                                method: 'PATCH',
                                headers: {
                                    'Authorization': 'Bearer YOUR_API_KEY',
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    fields: {
                                        "Latitude": lat,
                                        "Longitude": lng
                                    }
                                })
                            }
                        );

                        if (response.ok) {
                            alert("Coordinates saved to Airtable!");
                            window.close(); // Optional: Close the window after saving
                        } else {
                            alert("Failed to update Airtable.");
                        }
                    } catch (error) {
                        alert("Error: " + error.message);
                    }
                },
                (error) => {
                    alert("Error getting location: " + error.message);
                }
            );
        }
    </script>
</body>
</html>